{"remainingRequest":"/myp/vue/sell/node_modules/vue-loader/lib/index.js??vue-loader-options!/myp/vue/sell/src/components/goods/goods.vue?vue&type=script&lang=js&","dependencies":[{"path":"/myp/vue/sell/src/components/goods/goods.vue","mtime":1580813475598},{"path":"/myp/vue/sell/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/myp/vue/sell/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/myp/vue/sell/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/myp/vue/sell/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgSWNvbiBmcm9tICdjb21wb25lbnRzL2ljb24vaWNvbi52dWUnDQppbXBvcnQgU2hvb3BDYXJ0IGZyb20gJ2NvbXBvbmVudHMvc2hvb3BjYXJ0L3Nob29wY2FydC52dWUnDQppbXBvcnQgQ2FydENvbnRyb2wgZnJvbSAnY29tcG9uZW50cy9jYXJ0Y29udHJvbC9jYXJ0Y29udHJvbC52dWUnDQppbXBvcnQgRm9vZCBmcm9tICdjb21wb25lbnRzL2Zvb2QvZm9vZC52dWUnDQppbXBvcnQgQlNjcm9sbCBmcm9tICdAYmV0dGVyLXNjcm9sbC9jb3JlJw0KDQpjb25zdCBFUlJOT19PSyA9IDANCg0KZXhwb3J0IGRlZmF1bHQgew0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBnb29kczogW10sDQogICAgICBsaXN0SGVpZ2h0OiBbXSwNCiAgICAgIHNjcm9sbFk6IDAsDQogICAgICBzZWxlY3RlZEZvb2Q6IHt9DQogICAgfQ0KICB9LA0KICBwcm9wczogew0KICAgIHNlbGxlcjogT2JqZWN0DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBfaW5pdFNjcm9sbDogZnVuY3Rpb24oKSB7DQogICAgICAvLyDojrflj5bliLDov5nkuKpmb29kLXdyYXBwZXIgZG9tDQogICAgICB0aGlzLm1ldW5TY3JsbCA9IG5ldyBCU2Nyb2xsKHRoaXMuJHJlZnMubWVudVdyYXBwZXIsIHsNCiAgICAgICAgY2xpY2s6IHRydWUNCiAgICAgIH0pDQogICAgICB0aGlzLmZvb2RzU2NybGwgPSBuZXcgQlNjcm9sbCh0aGlzLiRyZWZzLmZvb2RzV3JhcHBlciwgew0KICAgICAgICAvLyDkvJrpmLvmraLpu5jorqTooYzkuLrvvIzpnIDopoHorr7nva4NCiAgICAgICAgY2xpY2s6IHRydWUsDQogICAgICAgIC8vIOebkeWQrHNjcm9sbA0KICAgICAgICBwcm9iZVR5cGU6IDMNCiAgICAgIH0pDQogICAgICB0aGlzLmZvb2RzU2NybGwub24oJ3Njcm9sbCcsIChwb3MpID0+IHsNCiAgICAgICAgdGhpcy5zY3JvbGxZID0gTWF0aC5hYnMoTWF0aC5yb3VuZChwb3MueSkpDQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5q+P5Liq57G75Z6L55qE6auY5bqmDQogICAgX2NhbGN1bGF0ZUhlaWdodDogZnVuY3Rpb24oKSB7DQogICAgICBsZXQgZm9vZExpc3QgPSB0aGlzLiRyZWZzLmZvb2RzV3JhcHBlci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdmb29kLWxpc3QtaG9vaycpDQogICAgICAvLyBjb25zb2xlLmxvZyhmb29kTGlzdCkNCiAgICAgIGxldCBoZWlnaHQgPSAwDQogICAgICB0aGlzLmxpc3RIZWlnaHQucHVzaChoZWlnaHQpDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvb2RMaXN0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBpdGVtID0gZm9vZExpc3RbaV0NCiAgICAgICAgaGVpZ2h0ICs9IGl0ZW0uY2xpZW50SGVpZ2h0DQogICAgICAgIHRoaXMubGlzdEhlaWdodC5wdXNoKGhlaWdodCkNCiAgICAgIH0NCiAgICB9LA0KICAgIHNlbGVjdE1lbnU6IGZ1bmN0aW9uIChpbmRleCwgZXZlbnQpIHsNCiAgICAgIGlmICghZXZlbnQuX2NvbnN0cnVjdGVkKSB7DQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgbGV0IGZvb2RMaXN0ID0gdGhpcy4kcmVmcy5mb29kc1dyYXBwZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZm9vZC1saXN0LWhvb2snKQ0KICAgICAgbGV0IGVsID0gZm9vZExpc3RbaW5kZXhdDQogICAgICB0aGlzLmZvb2RzU2NybGwuc2Nyb2xsVG9FbGVtZW50KGVsLCAzMDApDQogICAgICB0aGlzLnNjcm9sbFkgPSBNYXRoLmFicyh0aGlzLmxpc3RIZWlnaHRbaW5kZXhdKQ0KICAgIH0sDQogICAgc2VsZWN0Rm9vZDogZnVuY3Rpb24gKGZvb2QsIGV2ZW50KSB7DQogICAgICBpZiAoIWV2ZW50Ll9jb25zdHJ1Y3RlZCkgew0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuc2VsZWN0ZWRGb29kID0gZm9vZA0KICAgICAgdGhpcy4kcmVmcy5mb29kLnNob3coKQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBjdXJyZW50SW5kZXg6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5saXN0SGVpZ2h0Lmxlbmd0aCAtIDE7IGkrKykgew0KICAgICAgICBsZXQgaGVpZ2h0MSA9IHRoaXMubGlzdEhlaWdodFtpXQ0KICAgICAgICBsZXQgaGVpZ2h0MiA9IHRoaXMubGlzdEhlaWdodFtpICsgMV0NCiAgICAgICAgaWYgKCFoZWlnaHQyIHx8ICh0aGlzLnNjcm9sbFkgPj0gaGVpZ2h0MSAmJiB0aGlzLnNjcm9sbFkgPCBoZWlnaHQyKSkgew0KICAgICAgICAgIHJldHVybiBpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiAwDQogICAgfSwNCiAgICBzZWxlY3RGb29kczogZnVuY3Rpb24oKSB7DQogICAgICBsZXQgZm9vZHMgPSBbXQ0KICAgICAgdGhpcy5nb29kcy5mb3JFYWNoKChnb29kKSA9PiB7DQogICAgICAgIGdvb2QuZm9vZHMuZm9yRWFjaCgoZm9vZCkgPT4gew0KICAgICAgICAgIGlmIChmb29kLmNvdW50KSB7DQogICAgICAgICAgICBmb29kcy5wdXNoKGZvb2QpDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICAgIHJldHVybiBmb29kcw0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLiRodHRwLmdldCgnaHR0cDovL3NlbGxhZG1pbi5iZmNsb3Vkcy5jbi9nb29kcy5waHAnLCB7fSwgeyBlbXVsYXRlSlNPTjogdHJ1ZSB9KS50aGVuKChyZXMpID0+IHsNCiAgICAgIHJlcyA9IHJlcy5ib2R5DQogICAgICBpZiAocmVzLmVycm5vID09PSBFUlJOT19PSykgew0KICAgICAgICB0aGlzLmdvb2RzID0gcmVzLmRhdGENCiAgICAgICAgLy8g5aSE55CGRE9N5pe25LiA5a6a6KaB5L+d6K+BZG9t5bey57uP5riy5p+TDQogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0aGlzLl9pbml0U2Nyb2xsKCkNCiAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVIZWlnaHQoKQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0pLmNhdGNoKChyZXMpID0+IHsNCiAgICAgIHRoaXMuZ29vZHMgPSBbXQ0KICAgIH0pDQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICBJY29uLA0KICAgIFNob29wQ2FydCwNCiAgICBDYXJ0Q29udHJvbCwNCiAgICBGb29kDQogIH0NCn0NCg=="},{"version":3,"sources":["goods.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"goods.vue","sourceRoot":"src/components/goods","sourcesContent":["<template>\r\n  <div class=\"goods\">\r\n    <div class=\"menu-wrapper\" ref=\"menuWrapper\">\r\n      <ul>\r\n        <li\r\n          v-for=\"(item, index) in goods\"\r\n          :key=\"index\" class=\"menu-item\"\r\n          :class=\"{'current': currentIndex === index}\"\r\n          @click=\"selectMenu(index, $event)\"\r\n        >\r\n          <span class=\"text\">\r\n            <Icon\r\n              v-show=\"item.type > 0\"\r\n              :itemType = \"item.type\"\r\n              :size = \"312\"\r\n            ></Icon>\r\n            {{item.name}}\r\n          </span>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"foods-wrapper\" ref=\"foodsWrapper\">\r\n      <ul>\r\n        <li v-for=\"(good, index) in goods\" :key=index class=\"food-list-hook\">\r\n          <ul>\r\n            <span class=\"item-title\">{{good.name}}</span>\r\n            <li\r\n              v-for=\"(item, i) in good.foods\"\r\n              :key=i class=\"food-item\"\r\n            >\r\n              <div class=\"content-swipper\" @click.stop=\"selectFood(item, $event)\">\r\n                <div class=\"icon\">\r\n                  <img width=\"57px\" height=\"57px\" :src=\"item.icon\" alt=\"\">\r\n                </div>\r\n                <div class=\"content\">\r\n                  <h2 class=\"name\">{{item.name}}</h2>\r\n                  <p class=\"desc\">{{item.description}}</p>\r\n                  <div class=\"extra\">\r\n                    <span class=\"count\">月售{{item.sellCount}}份</span>\r\n                    <span>好评率{{item.rating}}</span>\r\n                  </div>\r\n                  <div class=\"price\">\r\n                    <span class=\"new-price\">￥{{item.price}}</span>\r\n                    <span v-show=\"good.oldPrice\" class=\"old-price\">￥{{good.oldPrice}}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <!-- 增加减少控件 -->\r\n              <div class=\"cartcontrol-wrapper\">\r\n                <CartControl\r\n                  :food=\"item\"\r\n                >\r\n                </CartControl>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <ShoopCart\r\n      :deliveryPri=\"seller.deliveryPrice\"\r\n      :minPri=\"seller.minPrice\"\r\n      :selectFoods=\"selectFoods\"\r\n    ></ShoopCart>\r\n    <Food\r\n      :food=\"selectedFood\"\r\n      ref=\"food\"\r\n    ></Food>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/ecmascript-6\">\r\nimport Icon from 'components/icon/icon.vue'\r\nimport ShoopCart from 'components/shoopcart/shoopcart.vue'\r\nimport CartControl from 'components/cartcontrol/cartcontrol.vue'\r\nimport Food from 'components/food/food.vue'\r\nimport BScroll from '@better-scroll/core'\r\n\r\nconst ERRNO_OK = 0\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      goods: [],\r\n      listHeight: [],\r\n      scrollY: 0,\r\n      selectedFood: {}\r\n    }\r\n  },\r\n  props: {\r\n    seller: Object\r\n  },\r\n  methods: {\r\n    _initScroll: function() {\r\n      // 获取到这个food-wrapper dom\r\n      this.meunScrll = new BScroll(this.$refs.menuWrapper, {\r\n        click: true\r\n      })\r\n      this.foodsScrll = new BScroll(this.$refs.foodsWrapper, {\r\n        // 会阻止默认行为，需要设置\r\n        click: true,\r\n        // 监听scroll\r\n        probeType: 3\r\n      })\r\n      this.foodsScrll.on('scroll', (pos) => {\r\n        this.scrollY = Math.abs(Math.round(pos.y))\r\n      })\r\n    },\r\n    // 每个类型的高度\r\n    _calculateHeight: function() {\r\n      let foodList = this.$refs.foodsWrapper.getElementsByClassName('food-list-hook')\r\n      // console.log(foodList)\r\n      let height = 0\r\n      this.listHeight.push(height)\r\n      for (let i = 0; i < foodList.length; i++) {\r\n        let item = foodList[i]\r\n        height += item.clientHeight\r\n        this.listHeight.push(height)\r\n      }\r\n    },\r\n    selectMenu: function (index, event) {\r\n      if (!event._constructed) {\r\n        return\r\n      }\r\n      let foodList = this.$refs.foodsWrapper.getElementsByClassName('food-list-hook')\r\n      let el = foodList[index]\r\n      this.foodsScrll.scrollToElement(el, 300)\r\n      this.scrollY = Math.abs(this.listHeight[index])\r\n    },\r\n    selectFood: function (food, event) {\r\n      if (!event._constructed) {\r\n        return\r\n      }\r\n      this.selectedFood = food\r\n      this.$refs.food.show()\r\n    }\r\n  },\r\n  computed: {\r\n    currentIndex: function () {\r\n      for (let i = 0; i < this.listHeight.length - 1; i++) {\r\n        let height1 = this.listHeight[i]\r\n        let height2 = this.listHeight[i + 1]\r\n        if (!height2 || (this.scrollY >= height1 && this.scrollY < height2)) {\r\n          return i\r\n        }\r\n      }\r\n      return 0\r\n    },\r\n    selectFoods: function() {\r\n      let foods = []\r\n      this.goods.forEach((good) => {\r\n        good.foods.forEach((food) => {\r\n          if (food.count) {\r\n            foods.push(food)\r\n          }\r\n        })\r\n      })\r\n      return foods\r\n    }\r\n  },\r\n  created() {\r\n    this.$http.get('http://selladmin.bfclouds.cn/goods.php', {}, { emulateJSON: true }).then((res) => {\r\n      res = res.body\r\n      if (res.errno === ERRNO_OK) {\r\n        this.goods = res.data\r\n        // 处理DOM时一定要保证dom已经渲染\r\n        this.$nextTick(() => {\r\n          this._initScroll()\r\n          this._calculateHeight()\r\n        })\r\n      }\r\n    }).catch((res) => {\r\n      this.goods = []\r\n    })\r\n  },\r\n  components: {\r\n    Icon,\r\n    ShoopCart,\r\n    CartControl,\r\n    Food\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\r\n@import 'common/stylus/mixin.styl'\r\n\r\n  .goods\r\n    display: flex\r\n    position: absolute\r\n    top: 174px\r\n    bottom: 46px\r\n    width: 100%\r\n    overflow: hidden\r\n    .menu-wrapper\r\n      display: flex\r\n      flex: 0 0 80px  //等分 缩放 占位空间\r\n      width: 80px\r\n      background-color: #f3f5f7\r\n      flex-flow: column wrap\r\n      .menu-item\r\n        display: table\r\n        width: 56px\r\n        height: 54px\r\n        padding: 0 12px\r\n        line-height: 14px\r\n        font-weight: 200\r\n        &.current\r\n          position: relative\r\n          font-size: 12px\r\n          margin-top: -1px\r\n          line-height: 14px\r\n          background: #fff\r\n          font-weight: 700\r\n        .text\r\n          display: table-cell\r\n          width: 56px\r\n          vertical-align: middle\r\n          border-1px(rgba(7, 17, 27, .1))\r\n          font-size: 12px\r\n\r\n    .foods-wrapper\r\n      flex: 1\r\n      .item-title\r\n        display: block\r\n        width: 100%\r\n        height: 26px\r\n        padding-left: 14px\r\n        border-left: 2px solid #d9dde1\r\n        line-height: 26px\r\n        font-size: 12px\r\n        color: rgb(147, 153, 159)\r\n        background-color: #f3f5f7\r\n      .food-item\r\n        display: flex\r\n        margin: 18px 18px 0\r\n        padding-bottom: 18px\r\n        border-1px(rgba(7, 17, 27, .1))\r\n        .content-swipper\r\n          width: 100%\r\n          &:last-child:after\r\n            display: none\r\n          .icon\r\n            flex: 0 0 57px\r\n            margin-right: 10px\r\n          .content\r\n            display: inline-block\r\n            flex: 1\r\n            .name\r\n              margin: 2px 0 8px 0\r\n              height: 14px\r\n              line-height: 14px\r\n              font-size: 14px\r\n              color: rgb(7,1 17, 27)\r\n            .desc\r\n              margin: 8px 0\r\n              font-size: 10px\r\n              line-height: 14px\r\n              color: rgb(147, 153, 159)\r\n              text-overflow: ellipsis\r\n            .extra\r\n              font-size: 10px\r\n              line-height: 10px\r\n              color: rgb(147, 153, 159)\r\n              .count\r\n                margin-right: 12px\r\n            .price\r\n              .new-price\r\n                font-size: 14px\r\n                color: rgb(240,20,20)\r\n                font-weight: 300\r\n                line-height: 24px\r\n              .old-price\r\n                font-size: 10px\r\n                color: rgb(147, 153, 159)\r\n                font-weight: 300\r\n                text-decoration: line-through\r\n        .cartcontrol-wrapper\r\n          position: absolute\r\n          bottom: 10px\r\n          right: 0px\r\n\r\n</style>\r\n"]}]}